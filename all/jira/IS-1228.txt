title: APCU - Letter - Adverse Action & Counter Offer / Risk Based PDFi Conversion to AFP2PDF Python [InHse]
description: Update existing processing script to no longer use PDFi tool to create pdf.
 Instead use afp2pdf.py program with index_build_multicore option for ALL statement related apps.
 The smaller daily notice jobs can use the current index_build options.

All the zip file, pgp encryption, index file contents, and PDF file naming convention must remain exactly the same original specifications.

Please ensure the standard SOP on the directory structure must be followed: 
 ${d_dir}/$cid/$cid$jid/pdf, ${d_dir}/$cid/$cid$jid/zip, ${d_dir}/$cid/$cid$jid/work is followed.
 Also, clear the folder directory folder before each processing. We do NOT want to accumulate previous runs.

The current program should support checking total PDF counts verification to make sure the expected pdf matches the total number for pdfs generated; If not, incorporate this standard verification logic

DT_JOB_ID:
 133597-C30.01-V22112

Processing Scripts to modify:
 apcudld_process.sh

Data Files to use:
 apcu_Notice_To_Spouse_061122_1.zip.pgp / apcu_Risk_Based_Pricing_061022_1.zip.pgp & apcu_Adverse_Action_060922_1.zip.pgp



*NOTE*: This job runs on RH2. Since we are migrating from RH2 to RHS, we should test all options so that we can do afpcompare and also ensure there is no errors in the processing logs.


author: william.kong
comment: [~anwarh]: Will Ruman still work on this project? I thought he is no longer with you guys. Please advise.


author: JIRAUSER10912
comment: Hi [~William.Kong] 

I am really Sorry for being late. I am working on this project and I will turn it over to QA as soon as possible.

Thanks!


author: JIRAUSER10912
comment: Hi [~Igor.Khosid] 

parallel ID :*20220907023640*
IS checklist :[^IS_Checklist.docx]
Test cases :[^Test_Cases.txt]
samples generated by previous script, dfa :*/z/dsi_pdfi_testing/apcudld/old/*
samples generated by updated script, dfa :*/z/dsi_pdfi_testing/apcudld/new/*



Thanks!


author: william.kong
comment: [~rumanb]: I checked /z/pdf_afp/apcu/apcudld/ and I do see the following standardized specifications followed:



*Please ensure the standard SOP on the directory structure must be followed:*
 *${d_dir}/$cid/$cid$jid/pdf, ${d_dir}/$cid/$cid$jid/zip, ${d_dir}/$cid/$cid$jid/work is followed.*



Please fix script to follow our standard folder structure. Once completed, please update status to "QA Request"






author: JIRAUSER10912
comment: Hi [~William.Kong] 

I fixed this issue and kept the updated script in parallel.
Parallel ID :*20220907023640*
Can You please check it again ?

Thanks!


author: william.kong
comment: [~rumanb]:  I noticed that the following new issues:



/z/apcu/apcudld/*pdf* folder:

There are multiple pdz index files? Is the program purging the pdf, zip, work folder in the*${d_dir}/$cid/$cid$jid/*prior to each run. I want to make sure we don't accumulate files indefinitely over time per SOP.

If it does not purge files, please make program purges this director first before creating the PDF and zip files.



/z/apcu/apcudld/*zip*folder:

I noticed there is subfolders within /zip. Normally we don't have subdirectories. Just the zip files and additionally the pgp encrypted files.

Furthermore there are pdf files in these subdirectories as well. as mentioned, only zip and if applicable, pgp files should be stored here.

Please also make sure this folder is purged before each run.



Once confirmed, please tell us where the old and new pdf file are so that we can do the final QA.



Please update status to "QA Request" with your findings/results.


author: JIRAUSER10912
comment: Hi [~William.Kong] 

About*/z/apcu/apcudld/pdf*folder:

According to the dfa coding of lettter 301,302,305, all of them produce 2 pdz files as index file and letter 303 generate single pdz file. That's why I generated a single index txt file by afp2pdf call and generated separated pdz files for those letters by script from those index txt files later. I also stored those index txt file and pdz files in pdf directory to make zip. But now I updated the script so that no index txt file and pdz file exist after making zip.


About*/z/apcu/apcudld/zip* folder :

If you look at*/z/dsi_pdfi_testing/apcudld/old/archival_samples*, according to previous script structure, zip files are distributed into 6 different folders. They are*member/ , member_re/, nonmem_aa/, nonmem_re/, nonmem_risk/, notice_spouse/*. So to follow this convention, I stored zip files intomember/, member_re/, nonmem_aa/, nonmem_re/, nonmem_risk/, notice_spouse/ folders inside*/z/apcu/apcudld/zip* folder. But now I updated the processing script so that only zip and pgp files are stored inside*/z/apcu/apcudld/zip* folder.

Can you please check it again ?

Old Samples are available in : */z/dsi_pdfi_testing/apcudld/old/*
New Samples are available in :*/z/dsi_pdfi_testing/apcudld/new/*



Thanks!


author: william.kong
comment: [~rumanb]: Sorry for the delayed acknowledgement. I missed several emails last week. Thank you for the clear explanation and the code fix. I will ask QA to resume this evaluation,





[~Igor.Khosid]/[~Andrey.Kutsenko]: I took the liberty to unzip and place the pdf files in the following location:



ca-isis-pr-04:

/d/pdf_afp/apcudld_prod/

/d/pdf_afp/apcudld_parallel/



Please resume QA when time permits.




author: william.kong
comment: [~rumanb]:



+*Issue #1:*+

Found a bug. The new version of the code is missing leading zeros for apcu_LOS_archival_090122_1.zip. Please review the original code and get the logic for leading zeros and apply to you programming. Please update status to QA Request when done.



*Production:*

{{apcu_LOS_archival_090122_1.zip}}
 {{ 424113 09-07-2022 02:11 {color:#de350b}*000*1174101_302359.pdf{color}}}

*Parallel:*

{{[williamK@ca-isis-pr-04 apcudld_prod]$ unzip -l ../apcudld_parallel/apcu_LOS_archival_090122_1.zip | grep 1174101}}
 {{ 436822 09-12-2022 22:56 {color:#de350b}1174101_302359.pdf{color}}}



*Issue #2:*

Please ensure you check and compare (i.e. diff) the index file between prod and parallel to make sure it matches. I do understand some notice may use processing date as the document date which will cause mismatch and also the order of the index may be off. However, the format / structure+must+ match how production is. I do not have time to go through ALL of the index files, but here is an example of one index file with issues. Please double check all the other notices as well:



apcu_nsp_index.pdz (formatting issue,):

In production, the there is no space between the key / value pair.

e.g.:

FormNam{color:#de350b}e=L{color}360 - WI Notice to Spouse

versus

FormNam*{color:#de350b}e = L{color}*360 - WI Notice to Spouse



apcu_nsp_index.pdz (Trailing spaces at the end of each line):

If you do a diff, you will notice there is an extra trailing space at the end of each line in the newer version of the code.



apcu_nsp_index.pdz (Missing field Application Number):

New code is missing Application Number key/value pair.
















author: william.kong
comment: [~rumanb]: Please advise if you think you can fix the issue above and likewise double check all the index file to make sure there is no issue by the due date of 9/22 as planned.


author: JIRAUSER10912
comment: Hi [~William.Kong] 

I will turn it over to QA within 09/22 after fixing this issue and double check those index files.

Thanks!


author: JIRAUSER10912
comment: Hi [~William.Kong]

I fixed the 2 issues that you mentioned above and I also checked all index files *structure/format*, *key-value pair formatting,* *trailing space issue*, *leading zero issues* 5 times. I think they look as like as production resources.

Can you please quickly perform a final check in any of those index files?

Old Samples are available in : */z/dsi_pdfi_testing/apcudld/old/*
 New Samples are available in :*/z/dsi_pdfi_testing/apcudld/new/*

Updated scripts and dfa's are available in *parallel ID :20220907023640*

Thanks!


author: william.kong
comment: [~rumanb]: I copied the zip file from /z/pdf_afp/apcu/apcudld/zip/ just now.

I spot checked super quickly to pdz files and it looks good (i.e. I expected document date and sequence numbers to be different).



I will advise QA in the afternoon to perform the full QA process after all my morning meetings. Thanks for getting this done on time and on schedule!






author: william.kong
comment: [~Igor.Khosid]/[~Andrey.Kutsenko]: I've placed the files in the following



*ca-isis-pr-04:*

/d/pdf_compare/apcudld_prod/

/d/pdf_compare/apcudld_parallel/



*Note:* There are several zip files for different types of notices so I unzipped all of them into the folder.

Please try to use this regex:

-regex '[0-9]+-*[sS]*[0-9]*_<SEQ>.pdf'

Maybe the pixel can be increased up to 12 pixels.






author: JIRAUSER11104
comment: Hi [~William.Kong], please advise.
 I ran the script with different values for the parameter "-pixels" and every time I get PDF Files with Differences.
{code:sh}
perl /home/util/pdf_compare.pl apcudld_prod/ apcudld_parallel/ result_apcudld -pixels 12 -threads 4 -maxfiles 4 -regex '[0-9]+-*[sS]*[0-9]*_<SEQ>.pdf'{code}
Take a look:
{code:sh}
[andreyK@ca-unittest-pr-02 ~]$ cat /d/pdf_compare/result_apcudld_1/pdf_compare_rpt.txt{code}
{quote}Total PDF Files Scanned: 4
 +*allowedDifferenceInPercentPerPage: 12:*+
 Thread Count: 4

Total PDF Files with Differences: 3
 WARNING: We did not compare ALL the pdfs!
 /home/util/pdf_compare.pl will only process the first 4 pdf files out of the total 1020 pdfs
 Start Time: Wed Sep 28 14:37:38 PDT 2022
 Finish Time: Wed Sep 28 14:38:25 PDT 2022
{quote}
{code:sh}
[andreyK@ca-unittest-pr-02 ~]$ cat /d/pdf_compare/result_apcudld_2/pdf_compare_rpt.txt{code}
{quote}Total PDF Files Scanned: 4
 +*allowedDifferenceInPercentPerPage: 14:*+
 Thread Count: 4

Total PDF Files with Differences: 3
 WARNING: We did not compare ALL the pdfs!
 /home/util/pdf_compare.pl will only process the first 4 pdf files out of the total 1020 pdfs
 Start Time: Wed Sep 28 14:40:46 PDT 2022
 Finish Time: Wed Sep 28 14:41:35 PDT 2022
{quote}
{code:sh}
[andreyK@ca-unittest-pr-02 ~]$ cat /d/pdf_compare/result_apcudld_3/pdf_compare_rpt.txt{code}
{quote}Total PDF Files Scanned: 4
 +*allowedDifferenceInPercentPerPage: 18:*+
 Thread Count: 4

Total PDF Files with Differences: 3
 WARNING: We did not compare ALL the pdfs!
 /home/util/pdf_compare.pl will only process the first 4 pdf files out of the total 1020 pdfs
 Start Time: Wed Sep 28 14:44:29 PDT 2022
 Finish Time: Wed Sep 28 14:45:17 PDT 2022
{quote}
{code:sh}
[andreyK@ca-unittest-pr-02 ~]$ cat /d/pdf_compare/result_apcudld/pdf_compare_rpt.txt{code}
{quote}Total PDF Files Scanned: 4
 +*allowedDifferenceInPercentPerPage: 25:*+
 Thread Count: 4

Total PDF Files with Differences: 3
 WARNING: We did not compare ALL the pdfs!
 /home/util/pdf_compare.pl will only process the first 4 pdf files out of the total 1020 pdfs
 Start Time: Wed Sep 28 14:48:27 PDT 2022
 Finish Time: Wed Sep 28 14:49:15 PDT 2022
{quote}


author: william.kong
comment: [~Andrey.Kutsenko]: Please see my comments below in {color:#00875a}GREEN{color}. All is good to me. We can have this pass. If you agree, please alert [~rumanb]and update status to "QA Completed".





Take a look:
{code:sh}
[andreyK@ca-unittest-pr-02 ~]$ cat /d/pdf_compare/result_apcudld_1/pdf_compare_rpt.txt{code}
{quote}Total PDF Files Scanned: 4
+*allowedDifferenceInPercentPerPage: 12:*+
Thread Count: 4

Total PDF Files with Differences: 3
WARNING: We did not compare ALL the pdfs!
/home/util/pdf_compare.pl will only process the first 4 pdf files out of the total 1020 pdfs
Start Time: Wed Sep 28 14:37:38 PDT 2022
Finish Time: Wed Sep 28 14:38:25 PDT 2022
{quote}
{color:#00875a}*GOOD*: There is a data difference with the Date field on page 1 which is expected. The 4 documents with differences is due to the document is using a PSEG large image where pixel differences will be expected.{color}
{code:sh}
[andreyK@ca-unittest-pr-02 ~]$ cat /d/pdf_compare/result_apcudld_2/pdf_compare_rpt.txt{code}
{quote}Total PDF Files Scanned: 4
+*allowedDifferenceInPercentPerPage: 14:*+
Thread Count: 4

Total PDF Files with Differences: 3
WARNING: We did not compare ALL the pdfs!
/home/util/pdf_compare.pl will only process the first 4 pdf files out of the total 1020 pdfs
Start Time: Wed Sep 28 14:40:46 PDT 2022
Finish Time: Wed Sep 28 14:41:35 PDT 2022

{color:#00875a}*GOOD*: Same explanation as above. I reviewed the 3 pdfs difference and is the same situation as above{color}
{quote}
{code:sh}
[andreyK@ca-unittest-pr-02 ~]$ cat /d/pdf_compare/result_apcudld_3/pdf_compare_rpt.txt{code}
{quote}Total PDF Files Scanned: 4
+*allowedDifferenceInPercentPerPage: 18:*+
Thread Count: 4

Total PDF Files with Differences: 3
WARNING: We did not compare ALL the pdfs!
/home/util/pdf_compare.pl will only process the first 4 pdf files out of the total 1020 pdfs
Start Time: Wed Sep 28 14:44:29 PDT 2022
Finish Time: Wed Sep 28 14:45:17 PDT 2022

{color:#00875a}*GOOD*: Same explanation as above. I reviewed the 3 pdfs difference and is the same situation as above{color}
{quote}
{code:sh}
[andreyK@ca-unittest-pr-02 ~]$ cat /d/pdf_compare/result_apcudld/pdf_compare_rpt.txt{code}
{quote}Total PDF Files Scanned: 4
+*allowedDifferenceInPercentPerPage: 25:*+
Thread Count: 4

Total PDF Files with Differences: 3
WARNING: We did not compare ALL the pdfs!
/home/util/pdf_compare.pl will only process the first 4 pdf files out of the total 1020 pdfs
Start Time: Wed Sep 28 14:48:27 PDT 2022
Finish Time: Wed Sep 28 14:49:15 PDT 2022

{color:#00875a}*GOOD*: Same explanation as above. I reviewed the 3 pdfs difference and is the same situation as above{color}
{quote}


author: JIRAUSER11104
comment: QA - Passed.
note: Based on the comment [~William.Kong]


author: william.kong
comment: [~rumanb]: Please prep File Transfer form so that we can get code release tomorrow. Will update due date for 10/5/2022


author: JIRAUSER10912
comment: Hi [~TunA] 

We need to release this app.
Here is the transfer form :[^IS_PROGRAM_TRANSFER_FORM.doc]
Resources are available in :*/d/is/cvs/xfer/rumanB*

Can you please release the code ?

Thanks!


author: tuna
comment: Hi [~rumanb],

Following codes have been released.

Thanks,

Tun



20221007091030 10/07/2022 rumanB IS-1228 APCU - Letter - Adverse Action & Counter Offer / Risk Based PDFi Conversion to AFP2PDF Python [InHse]

[oper1@rhs ~]$ ll /d/is/cvs/xfer/rumanB/
total 1224
-rwxrwxrwx 1 rumanB DSI 919 Oct 6 21:23 apcudl301.control
-rwxrwxrwx 1 rumanB DSI 35305 Oct 6 22:17 APCUDL301.dfa
-rwxrwxrwx 1 rumanB DSI 0 Oct 6 22:17 APCUDL301.prj
-rwxrwxrwx 1 rumanB DSI 919 Oct 6 21:40 apcudl302.control
-rwxrwxrwx 1 rumanB DSI 41568 Oct 6 22:17 APCUDL302.dfa
-rwxrwxrwx 1 rumanB DSI 0 Oct 6 22:16 APCUDL302.prj
-rwxrwxrwx 1 rumanB DSI 913 Oct 6 22:15 apcudl303.control
-rwxrwxrwx 1 rumanB DSI 20506 Oct 6 22:16 APCUDL303.dfa
-rwxrwxrwx 1 rumanB DSI 0 Oct 6 21:23 APCUDL303.prj
-rwxrwxrwx 1 rumanB DSI 913 Oct 6 22:16 apcudl305.control
-rwxrwxrwx 1 rumanB DSI 19533 Oct 6 21:40 APCUDL305.dfa
-rwxrwxrwx 1 rumanB DSI 0 Oct 6 22:17 APCUDL305.prj
-rwxrwxrwx 1 rumanB DSI 480 Oct 6 21:23 apcudld01_pdf.control
-rwxrwxrwx 1 rumanB DSI 480 Oct 6 21:40 apcudld02_pdf.control
-rwxrwxrwx 1 rumanB DSI 499 Oct 6 22:17 apcudld03_pdf.control
-rwxrwxrwx 1 rumanB DSI 480 Oct 6 21:40 apcudld05_pdf.control
-rwxrwxrwx 1 rumanB DSI 2707 Oct 6 22:15 apcudld_generate_pdz_files_from_index_file.py
-rwxrwxrwx 1 rumanB DSI 40060 Oct 6 22:16 apcudld_process.sh
-rwxrwxrwx 1 rumanB DSI 4141 Oct 6 22:17 apcudld.procs





[~William.Kong],[~rony], [~jharvey]
