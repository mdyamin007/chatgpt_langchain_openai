title: 13249 - FFFC - Selective Paperless for Visa
description: # Update Hypercube/InfoTRAC/API to enable selective paperless for visa.
 # Configure emails to send selectively for visa.
 # Update the External Enrollment Report to provide the selective paperless data.
 # Update the Enrollment File to accept selective paperless data.
 # Update the internal Paperless Report to provide a separate report for visa. (Work with IS)


author: mamunur.rashid
comment: Hi[~Patric K],

From the above description, I need some information.

Point 2: Is it about email sending selectively from Infotrac or from PUI?

Point 3: As far as I know External Enrollment Report is generated from Infotrac. Let me know if I am right or not.

Point 4: Do you mean "paperless process index file" by Enrollment FIle? Will theEnrollment File be provided by IS?

Thanks,

Mamun




author: mamunur.rashid
comment: Hi [~Patric K],

For *point 1 and 3* I have added the byselective paperless configuration into Hypercube and Infotrac properties.json file. It is working fine.

For*point 5*adding a flag (*paperlessReport.stmtType3=visa,visa*) into fffc.conf file will do the work.

For*point 2 and 4*I still need your information that I have asked in the previous comment.

Thanks,

Mamun




author: patric k
comment: Hi [~tai.trinh],

Can you comment on Mamunur's questions?


author: mamunur.rashid
comment: Hi[~tai.trinh],

Has IS updated Enrollment File. I need to know the updated format. Will statement types be comma separated?

Thanks,

Mamun


author: patric k
comment: Point 2) I believe emails are sent from pui.

*External Enrollment Report Update*

CIF_Number|Account_Number|Application|StmtType|Name|Email_Address|Mobile_Number|Delivery_Preference|Notification_Preference|Modified_date
 *|8896621||default|BARBARA A RIVAS|lammaloves6@gmail.com||E|email|1456164508*

*|8896621||visa|BARBARA A RIVAS|lammaloves6@gmail.com||E|email|1456164508*

default is the default delivery preference (the one that we are using currently for all customers)

visa is the delivery preference specifically for visa



*Enrollment File Update*

Example of enrolling an account into Electronic for Visa, but not the other eStatements.

*|70224||default|105 Mathews LLC|edtorrez@verizon.net||P|email|1285950291*

*|70224||visa|105 Mathews LLC|edtorrez@verizon.net||E|email|1285950291*


author: mamunur.rashid
comment: Hi[~Patric K],

Does FFFC process Paperless File using Scheduler? I tried to process paperless file from processing-ui frontend and got the following error in the processing job validate() method.

!image-2021-05-10-22-22-51-544.png!


author: patric k
comment: [~mamunur.rashid] its processed using the crontab.

On Dev PUI. Feel free to modify if needed. To run it you can use: _*bash fffc_paperless.bat \{filename}*_

Path = /usr/local/processing-ui/schedule/fffc_paperless.bat




author: tai.trinh
comment: Hi [~mamunur.rashid],

I noticed an incorrect change in the FFFC handler/registrar.

We don't actually store notification_preference by statement types. It's only for paperless statuses. The NP record should still always have "default" be the stmt_type. The email address is shared.



Also, I could be wrong, but don't we also need to update MongoDB? Does API use any configuration there?



I also do not see any updates to the External Enrollment Report in the Release Notes. This is the report being generated by the "enrollment" command (see the client conf file). There should already be a way to include statement type, but I think we need to enhance with filtering logic. Some of our code create the paperless status regardless of whether it is selective or not. So for FFFC, there might be "enotice" paperless status that exists, but not used. This information shouldn't be shown to the client, so we need a way to alter the query to pull only the necessary stmt types.

---

I also noticed that tag 8.0.9.2 is already created. Please do not create new tag until we're ready to go through with release. As far as I know, we're still only on Pilot testing for this.

I also noticed that theunenrollOnDeliveryPreferenceChange is now set to*false*. Is there a reason why this can no longer be supported?

Thanks,
 Tai


author: mamunur.rashid
comment: 

I haven't changed the method signature and method body of*createNotificationPreference()*. I just passed "default" as the method parameter. I tested it and saw that it inserts "default" as stmt_type in the notification_preference table. Anyway, I have done some code enhancement. Code is now in processing-ui-dev and processing-ui-pilot.

____

We don't need any update in MongoDB or API configuration for selective paperless.

____

If the External enrollment header is like below then a little code change is needed in EnrollmentReportCU.java.

_CIF_Number|Account_Number|Application|Name|Email_Address|Mobile_Number|Delivery_Preference|Notification_Preference|Modified_date|*Statement_Type*_

Cause the existing code already adds *Statement_Type* at the end of the header if*enrollment.statementType=true*

Otherwise, if Statement_Type is needed to be appended after *|Application|* a lot of code change will be needed.

Do we need client confirmation to add Statement_Type at the end of the header? Please confirm where Statement_Type will be placed in the report.

____

[~Patric K] told me to create8.0.9.2 tag. That's why I created it.

____

unenrollOnDeliveryPreferenceChange doesn't work with bySelective paperless. We talked with Joe. He told us to set it to false.



Thanks,

Mamun


author: rifat.mahmud
comment: [~tai.trinh]

In the description, it was mentioned to work on the external enrollment report. Mamun asked previously in the earlier comments whether it's infotrac or not, but seems like he didn't get any feedback. So Mamun worked on the infotrac report. Now, from your comment, looks like we need to work on the PUI enrollment report. So I need to confirm whether changes on infotrac will be needed or should we revert the changes on infotrac? 


author: tai.trinh
comment: [~rifat.mahmud]

I understand what happened. We won't be changing the InfoTRAC report.


[~mamunur.rashid]

*createNotificationPreference()*

Yes, this is fine. We are to pass always "default" for now; until we ever decide to have emails by stmt_type.

---

It's fine to leave the statement type at the very end.

We do still need to make the enhancement to filter down the statement types only to the ones that are relevant. There is a class called QueryUtil, and inside of it, there's a util function called DynamicSqlSeg. You can use this to help generate the query string necessary.

DynamicSqlSeg(["default","enotice"],"p2.stmt_type") -> " and p2.stmt_type in ('default','enotice')"



Thanks,
Tai


author: mamunur.rashid
comment: Hi [~tai.trinh],

I have done the coding. Should I commit the code to processing-ui pilot after testing?

Thanks.


author: tai.trinh
comment: Hi [~mamunur.rashid],

Is the code in dev? I'd like to take a look.

Thanks,
Tai


author: rifat.mahmud
comment: Hi [~tai.trinh],

The code is not committed yet, it's under testing. We've found that in paperless process for FFFC, NP records got deleted for an account if any of the account's statement type is processed with paper(B). But now as FFFC will be selective for visa, deleting NP records will be an issue. So we are checking the email handlers for FFFC whether they check paperless status as E before sending emails. If all of them check that, then we can remove the *deleting NP record* feature from paperless process. Let us know if you have any thoughts.

Thanks,
Rifat


author: mamunur.rashid
comment: Hi [~tai.trinh],

I have committed the code to processing-ui dev. I haven't committed the entire code to processing-ui pilot yet.

I have updated the release note. Please have a look and let me know your thoughts. If everything is okay then I'll commit the code to pilot.

Thanks.


author: tai.trinh
comment: Hi [~mamunur.rashid],

This will have to be delayed.

*EnrollmentReport*
I saw that you created a new query for selective paperless. Why was this necessary (though I'm not against it)? What does SELECT NULL do? I have never seen this before.

There is still one piece missing and that's defining what paperless stmt type to show. With the way we are setting up our data, we always create a paperless record for the statement type, especially if Document Processing is being used. So if we simply list out all statement types, if the client has mortgage statements, they will also see a mortgage paperless status. That status should be transparent to the client. It exists in our database, but is not being used anywhere (until mortgage becomes selective), and so the client should not see this show up in the report.

*EnrollmentRegistrar*

Yes, for FFFC, we should stop deleting the NP record. However, instead of updating the existing FFFC registrar/handler, I am wondering if we could update them to use the StandardEnrollmentHandler/Registrar.



I'm sorry that you did not receive the direction needed early on in the project. We probably should have a meeting to discuss all of this in person and lock in the details.

Thanks,
Tai




author: mamunur.rashid
comment: Hi [~tai.trinh],

I have updated the query for the enrollment report and now it is taking statement types from the conf file *(enrollment.selectivePaperlessStmtTypes=default,visa).* I have committed and deployed the code on processing-ui dev. I also updated the release note.

_______

The current FFFC paperless file format is like below:

*|70224||default|105 Mathews LLC|edtorrez@verizon.net||P|email|1285950291*

This format is not supported by*StandardEnrollmentHandler*. So if we want to use this hanlder for FFFC then file format is needed to be changed by IS.

If we use*FffcPaperlessHandler* (currently used by FFFC) and change the Registrar to

*StandardEnrollmentRegistrar* then it will work fine.

Let me know your thoughts.

Thanks,

Mamun




author: tai.trinh
comment: Hi [~mamunur.rashid],

I see. Yeah, I forgot they have to provide CIF, too.

Everything looks good. Please go ahead and move code to Pilot.

Thanks,
Tai


author: mamunur.rashid
comment: Hi[~tai.trinh],

Do you know if FFFC will pass "5" as paperless status? From their previous code, I have seen that if they pass "5" as paperless status then they make FinAccount status "H" and directly insert "B" as paperless status into paperless table. Also if paperless staus is sent as "E" it updates finAccount status to "A".

This logic is not present in StandardEnrollmentRegistrar. There is a method namedupdateFinAccountStatus(). But this method is not invoked.

Will they use this logic? If they do should I implement this in StandardEnrollmentRegistrar?

______

Also FYI, from FffcPaperlessRegistrar account number was being inserted as SESS_LOGIN_ID instead of !usr_id. I don't know why they did that. Should we run migration script for usr_session after migrating the registrar to StandardEnrollmentRegistrar?

Thanks,

Mamun






author: tai.trinh
comment: [~mamunur.rashid],

Yeah, the FFFC registrar is a copy of an old registrar. Some of the logic is probably from when it was before FFFC moved to Hypercube.

They do use the hold code. I have enhanced the StandardEnrollmentRegistrar to properly support this.

Also, another thing is that we need to update the paperless mapping for FFFC to the DefaultPaperlessMapping also. This also helps with making the hold code logic simple, since the default mapping will automatically map "5" to "B".



We can run this query for the usr_session
{code:java}
update usr_session set sess_login_id = '!' || usr_id where org_id = getorgid('fffc');
{code}
Thanks,
 Tai


author: mamunur.rashid
comment: Hi [~tai.trinh],

Code has been tested and committed to processing-ui pilot.

I have run the query for usr_session on dev_cu and pilot_cu.

I have updated the release note also.

Thanks,

Mamun


author: patric k
comment: Client request this project to be on hold.


author: patric k
comment: [~mamunur.rashid],

Can you update the report to change the columns to match this:



CIF_Number|Account_Number|Application|*StmtType*|Name|Email_Address|Mobile_Number|Delivery_Preference|Notification_Preference|Modified_date


author: patric k
comment: client approved pilot, prepping stage, go live scheduled 9/8


author: patric k
comment: client says not ready for live, wants to push till end of sept
